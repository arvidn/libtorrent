name: Windows

on:
   push:
      branches: [ RC_1_2 RC_2_0 master ]
   pull_request:

defaults:
   run:
      shell: cmd

jobs:

   tests:
      name: Test
      runs-on: windows-2019
      continue-on-error: true

      steps:
      - name: checkout
        uses: actions/checkout@v2.3.3
        with:
           submodules: recursive

      # there appears to be a bug in boost-build where referring to a
      # dependency that's on a different drive fails, deep in boost-build
      # while concatenating paths
      - name: setup boost
        run: |
          echo using msvc ; >%HOMEDRIVE%%HOMEPATH%\user-config.jam
          mklink /J boost %BOOST_ROOT_1_72_0%
          cd boost
          b2 headers

      - name: tests
        run: |
          set BOOST_ROOT=%CD%\boost
          set BOOST_BUILD_PATH=%BOOST_ROOT%\tools\build
          set PATH=%BOOST_ROOT%;%PATH%
          set PYTHON_INTERPRETER=python
          cd test
          b2 -l400 debug-iterators=on invariant-checks=full asserts=on cxxstd=11 warnings=all warnings-as-errors=on
