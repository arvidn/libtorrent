#This Jamfile requires boost-build v2 to build.

import modules ;
import os ;

BOOST_ROOT = [ modules.peek : BOOST_ROOT ] ;

use-project /boost/thread : $(BOOST_ROOT)/libs/thread/build ;
use-project /boost/filesystem : $(BOOST_ROOT)/libs/filesystem/build ;
use-project /boost/date_time : $(BOOST_ROOT)/libs/date_time/build ;


project torrent
	: requirements
	  <use>/boost/thread
	  <use>/boost/date_time
	  <use>/boost/filesystem
		
	  <library>/boost/thread
	  <library>/boost/date_time
	  <library>/boost/filesystem

	: usage-requirements 

	  <include>./include
	  <include>$(BOOST_ROOT)

# devstudio switches

	  <toolset>msvc-7:<cxxflags>/Zc:wchar_t
	  <toolset>msvc-7.1:<cxxflags>/Zc:wchar_t
	  <toolset>msvc:<define>WIN32

# gcc switches

	  <toolset>gcc:<cxxflags>-Wno-unused-variable

	;


SOURCES =
	allocate_resources.cpp
	alert.cpp
	entry.cpp
	identify_client.cpp
	peer_connection.cpp
	piece_picker.cpp
	policy.cpp
	session.cpp
	stat.cpp
	storage.cpp
	torrent.cpp
	torrent_handle.cpp
	torrent_info.cpp
	tracker_manager.cpp
	http_tracker_connection.cpp
	udp_tracker_connection.cpp
	sha1.c
	;

# use different versions of some files for
# windows

	if [ modules.peek : NT ]
	{
		SOURCES += socket_win.cpp ;
	}
	else
	{
		SOURCES += socket_bsd.cpp ;
	}

	if [ modules.peek : NT ] && toolset != msvc-6
	{
		SOURCES += file_win.cpp ;
	}
	else
	{
		SOURCES += file.cpp ;
	}


lib torrent
	:
	  zlib//zlib
	  src/$(SOURCES)
	: <include>./include
	  <threading>multi
	  <link>static
	: debug release
	;


